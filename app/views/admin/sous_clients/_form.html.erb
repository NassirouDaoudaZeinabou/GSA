<% sous_client = local_assigns[:sous_client] || @sous_client %>

<% if sous_client.nil? %>
  <p class="muted">Aucun sous-client fourni au formulaire.</p>
<% else %>
  <% if sous_client.errors.any? %>
    <div class="form-errors">
      <p><strong><%= pluralize(sous_client.errors.count, "erreur") %> empêche la sauvegarde :</strong></p>
      <ul>
        <% sous_client.errors.full_messages.each do |m| %>
          <li><%= m %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form_with(model: [:admin, sous_client.agent.client, sous_client.agent, sous_client], local: true, html: { class: 'sous-client-form' }) do |f| %>
    <div class="form-group">
      <%= f.label :nom, 'Nom *', class: 'form-label' %>
      <%= f.text_field :nom, class: 'form-input', placeholder: 'Entrez le nom', required: true %>
    </div>

    <div class="form-group">
      <%= f.label :prenom, 'Prénom *', class: 'form-label' %>
      <%= f.text_field :prenom, class: 'form-input', placeholder: 'Entrez le prénom', required: true %>
    </div>

    <div class="form-group">
      <%= f.label :relation, 'Type de relation *', class: 'form-label' %>
      <%= f.text_field :relation, 
          class: 'form-input', 
          placeholder: 'Ex: Conjoint(e), Enfant, Parent, Frère/Sœur, Ami(e)...',
          required: true,
          list: 'relation-suggestions' %>
      <datalist id="relation-suggestions">
        <option value="Conjoint(e)">
        <option value="Enfant">
        <option value="Parent">
        <option value="Frère/Sœur">
        <option value="Ami(e)">
        <option value="Partenaire">
        <option value="Cousin(e)">
      </datalist>
      <small class="form-hint">Précisez le lien de parenté ou la nature de la relation</small>
    </div>

    <div class="form-actions">
      <%= f.submit(sous_client.persisted? ? 'Mettre à jour' : 'Créer le sous-client', class: 'btn btn-primary') %>
      <%= link_to 'Annuler', 
          (sous_client.agent.present? ? admin_client_agent_path(sous_client.agent.client, sous_client.agent) : admin_clients_path),
          class: 'btn btn-secondary' %>
    </div>
  <% end %>
<% end %>